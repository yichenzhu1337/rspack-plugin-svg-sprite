# Contributing

Thanks for your interest in contributing to `rspack-plugin-svg-sprite`!

## Prerequisites

- [Node.js](https://nodejs.org/) >= 22
- [pnpm](https://pnpm.io/) >= 10

## Getting started

```bash
git clone https://github.com/yichenzhu1337/rspack-plugin-svg-sprite.git
cd rspack-plugin-svg-sprite
pnpm install
```

This installs dependencies for the plugin and both example apps (via pnpm workspaces).

## Project structure

```
rspack-plugin-svg-sprite/
├── src/                      # TypeScript source
│   ├── index.ts              # Package entry — re-exports SvgSpritePlugin
│   ├── loader.ts             # Rspack-compatible SVG loader
│   ├── plugin.ts             # SvgSpritePlugin (extract mode)
│   ├── runtime/
│   │   ├── browser-sprite.ts # Browser-side sprite manager (inline mode)
│   │   └── symbol.ts         # SpriteSymbol class
│   └── __tests__/            # Unit tests (rstest / Jest-compatible)
├── dist/                     # Compiled output (generated by `pnpm build`)
├── examples/
│   ├── react-rspack/         # React + Rspack demo using this plugin
│   └── react-webpack/        # React + Webpack demo using svg-sprite-loader (for comparison)
├── package.json
├── tsconfig.json
└── pnpm-workspace.yaml       # Declares examples/* as workspace members
```

## Common commands

```bash
# Build the plugin (TypeScript -> dist/)
pnpm build

# Run unit tests (builds first, then runs rstest)
pnpm test

# Lint TypeScript source
pnpm lint

# Auto-format with Prettier
pnpm format

# Type-check without emitting
pnpm typecheck

# Start the React + Rspack example on http://localhost:3000
pnpm dev:rspack

# Start the React + Webpack example on http://localhost:4000
pnpm dev:webpack
```

## Development workflow

1. Make your changes in `src/`.
2. Run `pnpm build` to compile.
3. Run `pnpm test` to make sure nothing is broken.
4. Run `pnpm lint` and `pnpm format` to catch style issues.
5. Test your changes against the example apps with `pnpm dev:rspack`.
6. Commit — the pre-commit hook runs lint-staged (ESLint + Prettier) automatically.
7. Open a pull request.

## How the plugin works

### Inline mode (default)

The loader parses each `.svg` file, wraps its content in a `<symbol>`, and generates a JS module that imports the browser-side sprite manager (`runtime/browser-sprite.ts`). At runtime, a hidden `<svg>` element is created in `document.body` and all symbols are appended to it. Icons are referenced via `<use xlink:href="#symbolId" />`.

### Extract mode

The loader registers each symbol with the `SvgSpritePlugin` via `this._compilation`. During the `processAssets` hook, the plugin collects all symbols and emits a combined `.svg` sprite file. The exported JS module contains the external URL (`sprite.svg#symbolId`) instead of a fragment-only reference.

## Testing

Tests use [rstest](https://rstest.rs) (Rspack-based, Jest-compatible). Run them with:

```bash
pnpm test
```

This compiles the TypeScript first (`tsc`), then runs the test files.

To run with coverage (Istanbul, 95% thresholds enforced):

```bash
pnpm test:ci
```

Coverage reports are generated in `coverage/` (HTML + LCOV). Coverage is also uploaded to [Codecov](https://codecov.io/gh/yichenzhu1337/rspack-plugin-svg-sprite) on every CI run.

## Code style

- TypeScript strict mode is enabled.
- [Prettier](https://prettier.io/) handles formatting (single quotes, trailing commas, 100 char width).
- [ESLint](https://eslint.org/) with `typescript-eslint` catches common issues.
- A pre-commit hook via [husky](https://typicode.github.io/husky/) + [lint-staged](https://github.com/lint-staged/lint-staged) runs both automatically on staged files.
- Keep the public API compatible with `svg-sprite-loader` — the exported symbol object should have the same shape (`id`, `viewBox`, `url`, `content`).
